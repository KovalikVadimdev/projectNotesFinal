import{a as Ot,h as ot,c as jt}from"./authUser-8hiuLYTf.js";var G=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wt(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}function Tt(c){if(Object.prototype.hasOwnProperty.call(c,"__esModule"))return c;var o=c.default;if(typeof o=="function"){var d=function f(){return this instanceof f?Reflect.construct(o,arguments,this.constructor):o.apply(this,arguments)};d.prototype=o.prototype}else d={};return Object.defineProperty(d,"__esModule",{value:!0}),Object.keys(c).forEach(function(f){var m=Object.getOwnPropertyDescriptor(c,f);Object.defineProperty(d,f,m.get?m:{enumerable:!0,get:function(){return c[f]}})}),d}var q={exports:{}};function Mt(c){throw new Error('Could not dynamically require "'+c+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var P={exports:{}};const $t={},Rt=Object.freeze(Object.defineProperty({__proto__:null,default:$t},Symbol.toStringTag,{value:"Module"})),St=Tt(Rt);var qt=P.exports,at;function Pt(){return at||(at=1,function(c,o){(function(d,f){c.exports=f()})(qt,function(){var d=d||function(f,m){var u;if(typeof window<"u"&&window.crypto&&(u=window.crypto),typeof self<"u"&&self.crypto&&(u=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(u=globalThis.crypto),!u&&typeof window<"u"&&window.msCrypto&&(u=window.msCrypto),!u&&typeof G<"u"&&G.crypto&&(u=G.crypto),!u&&typeof Mt=="function")try{u=St}catch{}var b=function(){if(u){if(typeof u.getRandomValues=="function")try{return u.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof u.randomBytes=="function")try{return u.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},w=Object.create||function(){function s(){}return function(i){var a;return s.prototype=i,a=new s,s.prototype=null,a}}(),y={},S=y.lib={},E=S.Base=function(){return{extend:function(s){var i=w(this);return s&&i.mixIn(s),(!i.hasOwnProperty("init")||this.init===i.init)&&(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var i in s)s.hasOwnProperty(i)&&(this[i]=s[i]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),_=S.WordArray=E.extend({init:function(s,i){s=this.words=s||[],i!=m?this.sigBytes=i:this.sigBytes=s.length*4},toString:function(s){return(s||x).stringify(this)},concat:function(s){var i=this.words,a=s.words,l=this.sigBytes,h=s.sigBytes;if(this.clamp(),l%4)for(var p=0;p<h;p++){var v=a[p>>>2]>>>24-p%4*8&255;i[l+p>>>2]|=v<<24-(l+p)%4*8}else for(var g=0;g<h;g+=4)i[l+g>>>2]=a[g>>>2];return this.sigBytes+=h,this},clamp:function(){var s=this.words,i=this.sigBytes;s[i>>>2]&=4294967295<<32-i%4*8,s.length=f.ceil(i/4)},clone:function(){var s=E.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var i=[],a=0;a<s;a+=4)i.push(b());return new _.init(i,s)}}),I=y.enc={},x=I.Hex={stringify:function(s){for(var i=s.words,a=s.sigBytes,l=[],h=0;h<a;h++){var p=i[h>>>2]>>>24-h%4*8&255;l.push((p>>>4).toString(16)),l.push((p&15).toString(16))}return l.join("")},parse:function(s){for(var i=s.length,a=[],l=0;l<i;l+=2)a[l>>>3]|=parseInt(s.substr(l,2),16)<<24-l%8*4;return new _.init(a,i/2)}},t=I.Latin1={stringify:function(s){for(var i=s.words,a=s.sigBytes,l=[],h=0;h<a;h++){var p=i[h>>>2]>>>24-h%4*8&255;l.push(String.fromCharCode(p))}return l.join("")},parse:function(s){for(var i=s.length,a=[],l=0;l<i;l++)a[l>>>2]|=(s.charCodeAt(l)&255)<<24-l%4*8;return new _.init(a,i)}},e=I.Utf8={stringify:function(s){try{return decodeURIComponent(escape(t.stringify(s)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(s){return t.parse(unescape(encodeURIComponent(s)))}},n=S.BufferedBlockAlgorithm=E.extend({reset:function(){this._data=new _.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=e.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var i,a=this._data,l=a.words,h=a.sigBytes,p=this.blockSize,v=p*4,g=h/v;s?g=f.ceil(g):g=f.max((g|0)-this._minBufferSize,0);var k=g*p,N=f.min(k*4,h);if(k){for(var L=0;L<k;L+=p)this._doProcessBlock(l,L);i=l.splice(0,k),a.sigBytes-=N}return new _.init(i,N)},clone:function(){var s=E.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0});S.Hasher=n.extend({cfg:E.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){n.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){s&&this._append(s);var i=this._doFinalize();return i},blockSize:16,_createHelper:function(s){return function(i,a){return new s.init(a).finalize(i)}},_createHmacHelper:function(s){return function(i,a){return new r.HMAC.init(s,a).finalize(i)}}});var r=y.algo={};return y}(Math);return d})}(P)),P.exports}var Ht=q.exports,ct;function Jt(){return ct||(ct=1,function(c,o){(function(d,f){c.exports=f(Pt())})(Ht,function(d){return function(f){var m=d,u=m.lib,b=u.WordArray,w=u.Hasher,y=m.algo,S=[],E=[];(function(){function x(r){for(var s=f.sqrt(r),i=2;i<=s;i++)if(!(r%i))return!1;return!0}function t(r){return(r-(r|0))*4294967296|0}for(var e=2,n=0;n<64;)x(e)&&(n<8&&(S[n]=t(f.pow(e,1/2))),E[n]=t(f.pow(e,1/3)),n++),e++})();var _=[],I=y.SHA256=w.extend({_doReset:function(){this._hash=new b.init(S.slice(0))},_doProcessBlock:function(x,t){for(var e=this._hash.words,n=e[0],r=e[1],s=e[2],i=e[3],a=e[4],l=e[5],h=e[6],p=e[7],v=0;v<64;v++){if(v<16)_[v]=x[t+v]|0;else{var g=_[v-15],k=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,N=_[v-2],L=(N<<15|N>>>17)^(N<<13|N>>>19)^N>>>10;_[v]=k+_[v-7]+L+_[v-16]}var T=a&l^~a&h,M=n&r^n&s^r&s,$=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),At=(a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25),it=p+At+T+E[v]+_[v],Ct=$+M;p=h,h=l,l=a,a=i+it|0,i=s,s=r,r=n,n=it+Ct|0}e[0]=e[0]+n|0,e[1]=e[1]+r|0,e[2]=e[2]+s|0,e[3]=e[3]+i|0,e[4]=e[4]+a|0,e[5]=e[5]+l|0,e[6]=e[6]+h|0,e[7]=e[7]+p|0},_doFinalize:function(){var x=this._data,t=x.words,e=this._nDataBytes*8,n=x.sigBytes*8;return t[n>>>5]|=128<<24-n%32,t[(n+64>>>9<<4)+14]=f.floor(e/4294967296),t[(n+64>>>9<<4)+15]=e,x.sigBytes=t.length*4,this._process(),this._hash},clone:function(){var x=w.clone.call(this);return x._hash=this._hash.clone(),x}});m.SHA256=w._createHelper(I),m.HmacSHA256=w._createHmacHelper(I)}(Math),d.SHA256})}(q)),q.exports}var Ut=Jt();const zt=wt(Ut);var V={exports:{}},lt;function Ft(){return lt||(lt=1,function(c){var o={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};o.cipher.aes=function(t){this.s[0][0][0]||this.O();var e,n,r,s,i=this.s[0][4],a=this.s[1];e=t.length;var l=1;if(e!==4&&e!==6&&e!==8)throw new o.exception.invalid("invalid aes key size");for(this.b=[r=t.slice(0),s=[]],t=e;t<4*e+28;t++)n=r[t-1],(t%e===0||e===8&&t%e===4)&&(n=i[n>>>24]<<24^i[n>>16&255]<<16^i[n>>8&255]<<8^i[n&255],t%e===0&&(n=n<<8^n>>>24^l<<24,l=l<<1^283*(l>>7))),r[t]=r[t-e]^n;for(e=0;t;e++,t--)n=r[e&3?t:t-4],s[e]=4>=t||4>e?n:a[0][i[n>>>24]]^a[1][i[n>>16&255]]^a[2][i[n>>8&255]]^a[3][i[n&255]]},o.cipher.aes.prototype={encrypt:function(t){return d(this,t,0)},decrypt:function(t){return d(this,t,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var t=this.s[0],e=this.s[1],n=t[4],r=e[4],s,i,a,l=[],h=[],p,v,g,k;for(s=0;256>s;s++)h[(l[s]=s<<1^283*(s>>7))^s]=s;for(i=a=0;!n[i];i^=p||1,a=h[a]||1)for(g=a^a<<1^a<<2^a<<3^a<<4,g=g>>8^g&255^99,n[i]=g,r[g]=i,v=l[s=l[p=l[i]]],k=16843009*v^65537*s^257*p^16843008*i,v=257*l[g]^16843008*g,s=0;4>s;s++)t[s][i]=v=v<<24^v>>>8,e[s][g]=k=k<<24^k>>>8;for(s=0;5>s;s++)t[s]=t[s].slice(0),e[s]=e[s].slice(0)}};function d(t,e,n){if(e.length!==4)throw new o.exception.invalid("invalid aes block size");var r=t.b[n],s=e[0]^r[0],i=e[n?3:1]^r[1],a=e[2]^r[2];e=e[n?1:3]^r[3];var l,h,p,v=r.length/4-2,g,k=4,N=[0,0,0,0];l=t.s[n],t=l[0];var L=l[1],T=l[2],M=l[3],$=l[4];for(g=0;g<v;g++)l=t[s>>>24]^L[i>>16&255]^T[a>>8&255]^M[e&255]^r[k],h=t[i>>>24]^L[a>>16&255]^T[e>>8&255]^M[s&255]^r[k+1],p=t[a>>>24]^L[e>>16&255]^T[s>>8&255]^M[i&255]^r[k+2],e=t[e>>>24]^L[s>>16&255]^T[i>>8&255]^M[a&255]^r[k+3],k+=4,s=l,i=h,a=p;for(g=0;4>g;g++)N[n?3&-g:g]=$[s>>>24]<<24^$[i>>16&255]<<16^$[a>>8&255]<<8^$[e&255]^r[k++],l=s,s=i,i=a,a=e,e=l;return N}o.bitArray={bitSlice:function(t,e,n){return t=o.bitArray.$(t.slice(e/32),32-(e&31)).slice(1),n===void 0?t:o.bitArray.clamp(t,n-e)},extract:function(t,e,n){var r=Math.floor(-e-n&31);return((e+n-1^e)&-32?t[e/32|0]<<32-r^t[e/32+1|0]>>>r:t[e/32|0]>>>r)&(1<<n)-1},concat:function(t,e){if(t.length===0||e.length===0)return t.concat(e);var n=t[t.length-1],r=o.bitArray.getPartial(n);return r===32?t.concat(e):o.bitArray.$(e,r,n|0,t.slice(0,t.length-1))},bitLength:function(t){var e=t.length;return e===0?0:32*(e-1)+o.bitArray.getPartial(t[e-1])},clamp:function(t,e){if(32*t.length<e)return t;t=t.slice(0,Math.ceil(e/32));var n=t.length;return e=e&31,0<n&&e&&(t[n-1]=o.bitArray.partial(e,t[n-1]&2147483648>>e-1,1)),t},partial:function(t,e,n){return t===32?e:(n?e|0:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(o.bitArray.bitLength(t)!==o.bitArray.bitLength(e))return!1;var n=0,r;for(r=0;r<t.length;r++)n|=t[r]^e[r];return n===0},$:function(t,e,n,r){var s;for(s=0,r===void 0&&(r=[]);32<=e;e-=32)r.push(n),n=0;if(e===0)return r.concat(t);for(s=0;s<t.length;s++)r.push(n|t[s]>>>e),n=t[s]<<32-e;return s=t.length?t[t.length-1]:0,t=o.bitArray.getPartial(s),r.push(o.bitArray.partial(e+t&31,32<e+t?n:r.pop(),1)),r},i:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]},byteswapM:function(t){var e,n;for(e=0;e<t.length;++e)n=t[e],t[e]=n>>>24|n>>>8&65280|(n&65280)<<8|n<<24;return t}},o.codec.utf8String={fromBits:function(t){var e="",n=o.bitArray.bitLength(t),r,s;for(r=0;r<n/8;r++)(r&3)===0&&(s=t[r/4]),e+=String.fromCharCode(s>>>8>>>8>>>8),s<<=8;return decodeURIComponent(escape(e))},toBits:function(t){t=unescape(encodeURIComponent(t));var e=[],n,r=0;for(n=0;n<t.length;n++)r=r<<8|t.charCodeAt(n),(n&3)===3&&(e.push(r),r=0);return n&3&&e.push(o.bitArray.partial(8*(n&3),r)),e}},o.codec.hex={fromBits:function(t){var e="",n;for(n=0;n<t.length;n++)e+=((t[n]|0)+0xf00000000000).toString(16).substr(4);return e.substr(0,o.bitArray.bitLength(t)/4)},toBits:function(t){var e,n=[],r;for(t=t.replace(/\s|0x/g,""),r=t.length,t=t+"00000000",e=0;e<t.length;e+=8)n.push(parseInt(t.substr(e,8),16)^0);return o.bitArray.clamp(n,4*r)}},o.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(t,e,n){var r=o.codec.base32.BASE,s=o.codec.base32.REMAINING,i="",a=0,l=o.codec.base32.B,h=0,p=o.bitArray.bitLength(t);for(n&&(l=o.codec.base32.X),n=0;i.length*r<p;)i+=l.charAt((h^t[n]>>>a)>>>s),a<r?(h=t[n]<<r-a,a+=s,n++):(h<<=r,a-=r);for(;i.length&7&&!e;)i+="=";return i},toBits:function(t,e){t=t.replace(/\s|=/g,"").toUpperCase();var n=o.codec.base32.BITS,r=o.codec.base32.BASE,s=o.codec.base32.REMAINING,i=[],a,l=0,h=o.codec.base32.B,p=0,v,g="base32";for(e&&(h=o.codec.base32.X,g="base32hex"),a=0;a<t.length;a++){if(v=h.indexOf(t.charAt(a)),0>v){if(!e)try{return o.codec.base32hex.toBits(t)}catch{}throw new o.exception.invalid("this isn't "+g+"!")}l>s?(l-=s,i.push(p^v>>>l),p=v<<n-l):(l+=r,p^=v<<n-l)}return l&56&&i.push(o.bitArray.partial(l&56,p,1)),i}},o.codec.base32hex={fromBits:function(t,e){return o.codec.base32.fromBits(t,e,1)},toBits:function(t){return o.codec.base32.toBits(t,1)}},o.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,n){var r="",s=0,i=o.codec.base64.B,a=0,l=o.bitArray.bitLength(t);for(n&&(i=i.substr(0,62)+"-_"),n=0;6*r.length<l;)r+=i.charAt((a^t[n]>>>s)>>>26),6>s?(a=t[n]<<6-s,s+=26,n++):(a<<=6,s-=6);for(;r.length&3&&!e;)r+="=";return r},toBits:function(t,e){t=t.replace(/\s|=/g,"");var n=[],r,s=0,i=o.codec.base64.B,a=0,l;for(e&&(i=i.substr(0,62)+"-_"),r=0;r<t.length;r++){if(l=i.indexOf(t.charAt(r)),0>l)throw new o.exception.invalid("this isn't base64!");26<s?(s-=26,n.push(a^l>>>s),a=l<<32-s):(s+=6,a^=l<<32-s)}return s&56&&n.push(o.bitArray.partial(s&56,a,1)),n}},o.codec.base64url={fromBits:function(t){return o.codec.base64.fromBits(t,1,1)},toBits:function(t){return o.codec.base64.toBits(t,1)}},o.hash.sha256=function(t){this.b[0]||this.O(),t?(this.F=t.F.slice(0),this.A=t.A.slice(0),this.l=t.l):this.reset()},o.hash.sha256.hash=function(t){return new o.hash.sha256().update(t).finalize()},o.hash.sha256.prototype={blockSize:512,reset:function(){return this.F=this.Y.slice(0),this.A=[],this.l=0,this},update:function(t){typeof t=="string"&&(t=o.codec.utf8String.toBits(t));var e,n=this.A=o.bitArray.concat(this.A,t);if(e=this.l,t=this.l=e+o.bitArray.bitLength(t),9007199254740991<t)throw new o.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var r=new Uint32Array(n),s=0;for(e=512+e-(512+e&511);e<=t;e+=512)f(this,r.subarray(16*s,16*(s+1))),s+=1;n.splice(0,16*s)}else for(e=512+e-(512+e&511);e<=t;e+=512)f(this,n.splice(0,16));return this},finalize:function(){var t,n=this.A,e=this.F,n=o.bitArray.concat(n,[o.bitArray.partial(1,1)]);for(t=n.length+2;t&15;t++)n.push(0);for(n.push(Math.floor(this.l/4294967296)),n.push(this.l|0);n.length;)f(this,n.splice(0,16));return this.reset(),e},Y:[],b:[],O:function(){function t(i){return 4294967296*(i-Math.floor(i))|0}for(var e=0,n=2,r,s;64>e;n++){for(s=!0,r=2;r*r<=n;r++)if(n%r===0){s=!1;break}s&&(8>e&&(this.Y[e]=t(Math.pow(n,.5))),this.b[e]=t(Math.pow(n,1/3)),e++)}}};function f(t,e){var n,r,s,i=t.F,a=t.b,l=i[0],h=i[1],p=i[2],v=i[3],g=i[4],k=i[5],N=i[6],L=i[7];for(n=0;64>n;n++)16>n?r=e[n]:(r=e[n+1&15],s=e[n+14&15],r=e[n&15]=(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(s>>>17^s>>>19^s>>>10^s<<15^s<<13)+e[n&15]+e[n+9&15]|0),r=r+L+(g>>>6^g>>>11^g>>>25^g<<26^g<<21^g<<7)+(N^g&(k^N))+a[n],L=N,N=k,k=g,g=v+r|0,v=p,p=h,h=l,l=r+(h&p^v&(h^p))+(h>>>2^h>>>13^h>>>22^h<<30^h<<19^h<<10)|0;i[0]=i[0]+l|0,i[1]=i[1]+h|0,i[2]=i[2]+p|0,i[3]=i[3]+v|0,i[4]=i[4]+g|0,i[5]=i[5]+k|0,i[6]=i[6]+N|0,i[7]=i[7]+L|0}o.mode.ccm={name:"ccm",G:[],listenProgress:function(t){o.mode.ccm.G.push(t)},unListenProgress:function(t){t=o.mode.ccm.G.indexOf(t),-1<t&&o.mode.ccm.G.splice(t,1)},fa:function(t){var e=o.mode.ccm.G.slice(),n;for(n=0;n<e.length;n+=1)e[n](t)},encrypt:function(t,e,n,r,s){var i,a=e.slice(0),l=o.bitArray,h=l.bitLength(n)/8,p=l.bitLength(a)/8;if(s=s||64,r=r||[],7>h)throw new o.exception.invalid("ccm: iv must be at least 7 bytes");for(i=2;4>i&&p>>>8*i;i++);return i<15-h&&(i=15-h),n=l.clamp(n,8*(15-i)),e=o.mode.ccm.V(t,e,n,r,s,i),a=o.mode.ccm.C(t,a,n,e,s,i),l.concat(a.data,a.tag)},decrypt:function(t,e,n,r,s){s=s||64,r=r||[];var i=o.bitArray,a=i.bitLength(n)/8,p=i.bitLength(e),l=i.clamp(e,p-s),h=i.bitSlice(e,p-s),p=(p-s)/8;if(7>a)throw new o.exception.invalid("ccm: iv must be at least 7 bytes");for(e=2;4>e&&p>>>8*e;e++);if(e<15-a&&(e=15-a),n=i.clamp(n,8*(15-e)),l=o.mode.ccm.C(t,l,n,h,s,e),t=o.mode.ccm.V(t,l.data,n,r,s,e),!i.equal(l.tag,t))throw new o.exception.corrupt("ccm: tag doesn't match");return l.data},na:function(t,e,n,r,s,i){var a=[],l=o.bitArray,h=l.i;if(r=[l.partial(8,(e.length?64:0)|r-2<<2|i-1)],r=l.concat(r,n),r[3]|=s,r=t.encrypt(r),e.length)for(n=l.bitLength(e)/8,65279>=n?a=[l.partial(16,n)]:4294967295>=n&&(a=l.concat([l.partial(16,65534)],[n])),a=l.concat(a,e),e=0;e<a.length;e+=4)r=t.encrypt(h(r,a.slice(e,e+4).concat([0,0,0])));return r},V:function(t,e,n,r,s,i){var a=o.bitArray,l=a.i;if(s/=8,s%2||4>s||16<s)throw new o.exception.invalid("ccm: invalid tag length");if(4294967295<r.length||4294967295<e.length)throw new o.exception.bug("ccm: can't deal with 4GiB or more data");for(n=o.mode.ccm.na(t,r,n,s,a.bitLength(e)/8,i),r=0;r<e.length;r+=4)n=t.encrypt(l(n,e.slice(r,r+4).concat([0,0,0])));return a.clamp(n,8*s)},C:function(t,e,n,r,s,i){var a,l=o.bitArray;a=l.i;var h=e.length,p=l.bitLength(e),v=h/50,g=v;if(n=l.concat([l.partial(8,i-1)],n).concat([0,0,0]).slice(0,4),r=l.bitSlice(a(r,t.encrypt(n)),0,s),!h)return{tag:r,data:[]};for(a=0;a<h;a+=4)a>v&&(o.mode.ccm.fa(a/h),v+=g),n[3]++,s=t.encrypt(n),e[a]^=s[0],e[a+1]^=s[1],e[a+2]^=s[2],e[a+3]^=s[3];return{tag:r,data:l.clamp(e,p)}}},o.mode.ocb2={name:"ocb2",encrypt:function(t,e,n,r,s,i){if(o.bitArray.bitLength(n)!==128)throw new o.exception.invalid("ocb iv must be 128 bits");var a,l=o.mode.ocb2.S,h=o.bitArray,p=h.i,v=[0,0,0,0];n=l(t.encrypt(n));var g,k=[];for(r=r||[],s=s||64,a=0;a+4<e.length;a+=4)g=e.slice(a,a+4),v=p(v,g),k=k.concat(p(n,t.encrypt(p(n,g)))),n=l(n);return g=e.slice(a),e=h.bitLength(g),a=t.encrypt(p(n,[0,0,0,e])),g=h.clamp(p(g.concat([0,0,0]),a),e),v=p(v,p(g.concat([0,0,0]),a)),v=t.encrypt(p(v,p(n,l(n)))),r.length&&(v=p(v,i?r:o.mode.ocb2.pmac(t,r))),k.concat(h.concat(g,h.clamp(v,s)))},decrypt:function(t,e,n,r,s,i){if(o.bitArray.bitLength(n)!==128)throw new o.exception.invalid("ocb iv must be 128 bits");s=s||64;var a=o.mode.ocb2.S,l=o.bitArray,h=l.i,p=[0,0,0,0],v=a(t.encrypt(n)),g,k,N=o.bitArray.bitLength(e)-s,L=[];for(r=r||[],n=0;n+4<N/32;n+=4)g=h(v,t.decrypt(h(v,e.slice(n,n+4)))),p=h(p,g),L=L.concat(g),v=a(v);if(k=N-32*n,g=t.encrypt(h(v,[0,0,0,k])),g=h(g,l.clamp(e.slice(n),k).concat([0,0,0])),p=h(p,g),p=t.encrypt(h(p,h(v,a(v)))),r.length&&(p=h(p,i?r:o.mode.ocb2.pmac(t,r))),!l.equal(l.clamp(p,s),l.bitSlice(e,N)))throw new o.exception.corrupt("ocb: tag doesn't match");return L.concat(l.clamp(g,k))},pmac:function(t,e){var n,r=o.mode.ocb2.S,s=o.bitArray,i=s.i,a=[0,0,0,0],l=t.encrypt([0,0,0,0]),l=i(l,r(r(l)));for(n=0;n+4<e.length;n+=4)l=r(l),a=i(a,t.encrypt(i(l,e.slice(n,n+4))));return n=e.slice(n),128>s.bitLength(n)&&(l=i(l,r(l)),n=s.concat(n,[-2147483648,0,0,0])),a=i(a,n),t.encrypt(i(r(i(l,r(l))),a))},S:function(t){return[t[0]<<1^t[1]>>>31,t[1]<<1^t[2]>>>31,t[2]<<1^t[3]>>>31,t[3]<<1^135*(t[0]>>>31)]}},o.mode.gcm={name:"gcm",encrypt:function(t,e,n,r,s){var i=e.slice(0);return e=o.bitArray,r=r||[],t=o.mode.gcm.C(!0,t,i,r,n,s||128),e.concat(t.data,t.tag)},decrypt:function(t,e,n,r,s){var i=e.slice(0),a=o.bitArray,l=a.bitLength(i);if(s=s||128,r=r||[],s<=l?(e=a.bitSlice(i,l-s),i=a.bitSlice(i,0,l-s)):(e=i,i=[]),t=o.mode.gcm.C(!1,t,i,r,n,s),!a.equal(t.tag,e))throw new o.exception.corrupt("gcm: tag doesn't match");return t.data},ka:function(t,e){var n,r,s,i,a,l=o.bitArray.i;for(s=[0,0,0,0],i=e.slice(0),n=0;128>n;n++){for((r=(t[Math.floor(n/32)]&1<<31-n%32)!==0)&&(s=l(s,i)),a=(i[3]&1)!==0,r=3;0<r;r--)i[r]=i[r]>>>1|(i[r-1]&1)<<31;i[0]>>>=1,a&&(i[0]^=-520093696)}return s},j:function(t,e,n){var r,s=n.length;for(e=e.slice(0),r=0;r<s;r+=4)e[0]^=4294967295&n[r],e[1]^=4294967295&n[r+1],e[2]^=4294967295&n[r+2],e[3]^=4294967295&n[r+3],e=o.mode.gcm.ka(e,t);return e},C:function(t,e,n,r,s,i){var a,l,h,p,v,g,k,N,L=o.bitArray;for(g=n.length,k=L.bitLength(n),N=L.bitLength(r),l=L.bitLength(s),a=e.encrypt([0,0,0,0]),l===96?(s=s.slice(0),s=L.concat(s,[1])):(s=o.mode.gcm.j(a,[0,0,0,0],s),s=o.mode.gcm.j(a,s,[0,0,Math.floor(l/4294967296),l&4294967295])),l=o.mode.gcm.j(a,[0,0,0,0],r),v=s.slice(0),r=l.slice(0),t||(r=o.mode.gcm.j(a,l,n)),p=0;p<g;p+=4)v[3]++,h=e.encrypt(v),n[p]^=h[0],n[p+1]^=h[1],n[p+2]^=h[2],n[p+3]^=h[3];return n=L.clamp(n,k),t&&(r=o.mode.gcm.j(a,l,n)),t=[Math.floor(N/4294967296),N&4294967295,Math.floor(k/4294967296),k&4294967295],r=o.mode.gcm.j(a,r,t),h=e.encrypt(s),r[0]^=h[0],r[1]^=h[1],r[2]^=h[2],r[3]^=h[3],{tag:L.bitSlice(r,0,i),data:n}}},o.misc.hmac=function(t,e){this.W=e=e||o.hash.sha256;var n=[[],[]],r,s=e.prototype.blockSize/32;for(this.w=[new e,new e],t.length>s&&(t=e.hash(t)),r=0;r<s;r++)n[0][r]=t[r]^909522486,n[1][r]=t[r]^1549556828;this.w[0].update(n[0]),this.w[1].update(n[1]),this.R=new e(this.w[0])},o.misc.hmac.prototype.encrypt=o.misc.hmac.prototype.mac=function(t){if(this.aa)throw new o.exception.invalid("encrypt on already updated hmac called!");return this.update(t),this.digest(t)},o.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]),this.aa=!1},o.misc.hmac.prototype.update=function(t){this.aa=!0,this.R.update(t)},o.misc.hmac.prototype.digest=function(){var t=this.R.finalize(),t=new this.W(this.w[1]).update(t).finalize();return this.reset(),t},o.misc.pbkdf2=function(t,e,n,r,s){if(n=n||1e4,0>r||0>n)throw new o.exception.invalid("invalid params to pbkdf2");typeof t=="string"&&(t=o.codec.utf8String.toBits(t)),typeof e=="string"&&(e=o.codec.utf8String.toBits(e)),s=s||o.misc.hmac,t=new s(t);var i,a,l,h,p=[],v=o.bitArray;for(h=1;32*p.length<(r||1);h++){for(s=i=t.encrypt(v.concat(e,[h])),a=1;a<n;a++)for(i=t.encrypt(i),l=0;l<i.length;l++)s[l]^=i[l];p=p.concat(s)}return r&&(p=v.clamp(p,r)),p},o.prng=function(t){this.c=[new o.hash.sha256],this.m=[0],this.P=0,this.H={},this.N=0,this.U={},this.Z=this.f=this.o=this.ha=0,this.b=[0,0,0,0,0,0,0,0],this.h=[0,0,0,0],this.L=void 0,this.M=t,this.D=!1,this.K={progress:{},seeded:{}},this.u=this.ga=0,this.I=1,this.J=2,this.ca=65536,this.T=[0,48,64,96,128,192,256,384,512,768,1024],this.da=3e4,this.ba=80},o.prng.prototype={randomWords:function(t,e){var n=[],r;r=this.isReady(e);var s;if(r===this.u)throw new o.exception.notReady("generator isn't seeded");if(r&this.J){r=!(r&this.I),s=[];var i=0,a;for(this.Z=s[0]=new Date().valueOf()+this.da,a=0;16>a;a++)s.push(4294967296*Math.random()|0);for(a=0;a<this.c.length&&(s=s.concat(this.c[a].finalize()),i+=this.m[a],this.m[a]=0,r||!(this.P&1<<a));a++);for(this.P>=1<<this.c.length&&(this.c.push(new o.hash.sha256),this.m.push(0)),this.f-=i,i>this.o&&(this.o=i),this.P++,this.b=o.hash.sha256.hash(this.b.concat(s)),this.L=new o.cipher.aes(this.b),r=0;4>r&&(this.h[r]=this.h[r]+1|0,!this.h[r]);r++);}for(r=0;r<t;r+=4)(r+1)%this.ca===0&&b(this),s=w(this),n.push(s[0],s[1],s[2],s[3]);return b(this),n.slice(0,t)},setDefaultParanoia:function(t,e){if(t===0&&e!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new o.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=t},addEntropy:function(t,e,n){n=n||"user";var r,s,i=new Date().valueOf(),a=this.H[n],l=this.isReady(),h=0;switch(r=this.U[n],r===void 0&&(r=this.U[n]=this.ha++),a===void 0&&(a=this.H[n]=0),this.H[n]=(this.H[n]+1)%this.c.length,typeof t){case"number":e===void 0&&(e=1),this.c[a].update([r,this.N++,1,e,i,1,t|0]);break;case"object":if(n=Object.prototype.toString.call(t),n==="[object Uint32Array]"){for(s=[],n=0;n<t.length;n++)s.push(t[n]);t=s}else for(n!=="[object Array]"&&(h=1),n=0;n<t.length&&!h;n++)typeof t[n]!="number"&&(h=1);if(!h){if(e===void 0)for(n=e=0;n<t.length;n++)for(s=t[n];0<s;)e++,s=s>>>1;this.c[a].update([r,this.N++,2,e,i,t.length].concat(t))}break;case"string":e===void 0&&(e=t.length),this.c[a].update([r,this.N++,3,e,i,t.length]),this.c[a].update(t);break;default:h=1}if(h)throw new o.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[a]+=e,this.f+=e,l===this.u&&(this.isReady()!==this.u&&m("seeded",Math.max(this.o,this.f)),m("progress",this.getProgress()))},isReady:function(t){return t=this.T[t!==void 0?t:this.M],this.o&&this.o>=t?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=t?this.J|this.u:this.u},getProgress:function(t){return t=this.T[t||this.M],this.o>=t||this.f>t?1:this.f/t},startCollectors:function(){if(!this.D){if(this.a={loadTimeCollector:y(this,this.ma),mouseCollector:y(this,this.oa),keyboardCollector:y(this,this.la),accelerometerCollector:y(this,this.ea),touchCollector:y(this,this.qa)},window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new o.exception.bug("can't attach event");this.D=!0}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=!1)},addEventListener:function(t,e){this.K[t][this.ga++]=e},removeEventListener:function(t,e){var n,r,s=this.K[t],i=[];for(r in s)s.hasOwnProperty(r)&&s[r]===e&&i.push(r);for(n=0;n<i.length;n++)r=i[n],delete s[r]},la:function(){u(this,1)},oa:function(t){var e,n;try{e=t.x||t.clientX||t.offsetX||0,n=t.y||t.clientY||t.offsetY||0}catch{n=e=0}e!=0&&n!=0&&this.addEntropy([e,n],2,"mouse"),u(this,0)},qa:function(t){t=t.touches[0]||t.changedTouches[0],this.addEntropy([t.pageX||t.clientX,t.pageY||t.clientY],1,"touch"),u(this,0)},ma:function(){u(this,2)},ea:function(t){if(t=t.accelerationIncludingGravity.x||t.accelerationIncludingGravity.y||t.accelerationIncludingGravity.z,window.orientation){var e=window.orientation;typeof e=="number"&&this.addEntropy(e,1,"accelerometer")}t&&this.addEntropy(t,2,"accelerometer"),u(this,0)}};function m(t,e){var n,r=o.random.K[t],s=[];for(n in r)r.hasOwnProperty(n)&&s.push(r[n]);for(n=0;n<s.length;n++)s[n](e)}function u(t,e){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?t.addEntropy(window.performance.now(),e,"loadtime"):t.addEntropy(new Date().valueOf(),e,"loadtime")}function b(t){t.b=w(t).concat(w(t)),t.L=new o.cipher.aes(t.b)}function w(t){for(var e=0;4>e&&(t.h[e]=t.h[e]+1|0,!t.h[e]);e++);return t.L.encrypt(t.h)}function y(t,e){return function(){e.apply(t,arguments)}}o.random=new o.prng(6);t:try{var S,E,_,I;if(I=c.exports){var x;try{x=St}catch{x=null}I=E=x}if(I&&E.randomBytes)S=E.randomBytes(128),S=new Uint32Array(new Uint8Array(S).buffer),o.random.addEntropy(S,1024,"crypto['randomBytes']");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(_=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(_);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(_);else break t;o.random.addEntropy(_,1024,"crypto['getRandomValues']")}}catch(t){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(t))}o.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(t,e,n,r){n=n||{},r=r||{};var s=o.json,i=s.g({iv:o.random.randomWords(4,0)},s.defaults),a;if(s.g(i,n),n=i.adata,typeof i.salt=="string"&&(i.salt=o.codec.base64.toBits(i.salt)),typeof i.iv=="string"&&(i.iv=o.codec.base64.toBits(i.iv)),!o.mode[i.mode]||!o.cipher[i.cipher]||typeof t=="string"&&100>=i.iter||i.ts!==64&&i.ts!==96&&i.ts!==128||i.ks!==128&&i.ks!==192&&i.ks!==256||2>i.iv.length||4<i.iv.length)throw new o.exception.invalid("json encrypt: invalid parameters");return typeof t=="string"?(a=o.misc.cachedPbkdf2(t,i),t=a.key.slice(0,i.ks/32),i.salt=a.salt):o.ecc&&t instanceof o.ecc.elGamal.publicKey&&(a=t.kem(),i.kemtag=a.tag,t=a.key.slice(0,i.ks/32)),typeof e=="string"&&(e=o.codec.utf8String.toBits(e)),typeof n=="string"&&(i.adata=n=o.codec.utf8String.toBits(n)),a=new o.cipher[i.cipher](t),s.g(r,i),r.key=t,i.ct=i.mode==="ccm"&&o.arrayBuffer&&o.arrayBuffer.ccm&&e instanceof ArrayBuffer?o.arrayBuffer.ccm.encrypt(a,e,i.iv,n,i.ts):o.mode[i.mode].encrypt(a,e,i.iv,n,i.ts),i},encrypt:function(t,e,n,r){var s=o.json,i=s.ja.apply(s,arguments);return s.encode(i)},ia:function(t,e,n,r){n=n||{},r=r||{};var s=o.json;e=s.g(s.g(s.g({},s.defaults),e),n,!0);var i,a;if(i=e.adata,typeof e.salt=="string"&&(e.salt=o.codec.base64.toBits(e.salt)),typeof e.iv=="string"&&(e.iv=o.codec.base64.toBits(e.iv)),!o.mode[e.mode]||!o.cipher[e.cipher]||typeof t=="string"&&100>=e.iter||e.ts!==64&&e.ts!==96&&e.ts!==128||e.ks!==128&&e.ks!==192&&e.ks!==256||!e.iv||2>e.iv.length||4<e.iv.length)throw new o.exception.invalid("json decrypt: invalid parameters");return typeof t=="string"?(a=o.misc.cachedPbkdf2(t,e),t=a.key.slice(0,e.ks/32),e.salt=a.salt):o.ecc&&t instanceof o.ecc.elGamal.secretKey&&(t=t.unkem(o.codec.base64.toBits(e.kemtag)).slice(0,e.ks/32)),typeof i=="string"&&(i=o.codec.utf8String.toBits(i)),a=new o.cipher[e.cipher](t),i=e.mode==="ccm"&&o.arrayBuffer&&o.arrayBuffer.ccm&&e.ct instanceof ArrayBuffer?o.arrayBuffer.ccm.decrypt(a,e.ct,e.iv,e.tag,i,e.ts):o.mode[e.mode].decrypt(a,e.ct,e.iv,i,e.ts),s.g(r,e),r.key=t,n.raw===1?i:o.codec.utf8String.fromBits(i)},decrypt:function(t,e,n,r){var s=o.json;return s.ia(t,s.decode(e),n,r)},encode:function(t){var e,n="{",r="";for(e in t)if(t.hasOwnProperty(e)){if(!e.match(/^[a-z0-9]+$/i))throw new o.exception.invalid("json encode: invalid property name");switch(n+=r+'"'+e+'":',r=",",typeof t[e]){case"number":case"boolean":n+=t[e];break;case"string":n+='"'+escape(t[e])+'"';break;case"object":n+='"'+o.codec.base64.fromBits(t[e],0)+'"';break;default:throw new o.exception.bug("json encode: unsupported type")}}return n+"}"},decode:function(t){if(t=t.replace(/\s/g,""),!t.match(/^\{.*\}$/))throw new o.exception.invalid("json decode: this isn't json!");t=t.replace(/^\{|\}$/g,"").split(/,/);var e={},n,r;for(n=0;n<t.length;n++){if(!(r=t[n].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new o.exception.invalid("json decode: this isn't json!");r[3]!=null?e[r[2]]=parseInt(r[3],10):r[4]!=null?e[r[2]]=r[2].match(/^(ct|adata|salt|iv)$/)?o.codec.base64.toBits(r[4]):unescape(r[4]):r[5]!=null&&(e[r[2]]=r[5]==="true")}return e},g:function(t,e,n){if(t===void 0&&(t={}),e===void 0)return t;for(var r in e)if(e.hasOwnProperty(r)){if(n&&t[r]!==void 0&&t[r]!==e[r])throw new o.exception.invalid("required parameter overridden");t[r]=e[r]}return t},sa:function(t,e){var n={},r;for(r in t)t.hasOwnProperty(r)&&t[r]!==e[r]&&(n[r]=t[r]);return n},ra:function(t,e){var n={},r;for(r=0;r<e.length;r++)t[e[r]]!==void 0&&(n[e[r]]=t[e[r]]);return n}},o.encrypt=o.json.encrypt,o.decrypt=o.json.decrypt,o.misc.pa={},o.misc.cachedPbkdf2=function(t,e){var n=o.misc.pa,r;return e=e||{},r=e.iter||1e3,n=n[t]=n[t]||{},r=n[r]=n[r]||{firstSalt:e.salt&&e.salt.length?e.salt.slice(0):o.random.randomWords(2,0)},n=e.salt===void 0?r.firstSalt:e.salt,r[n]=r[n]||o.misc.pbkdf2(t,n,e.iter),{key:r[n].slice(0),salt:n.slice(0)}},c.exports&&(c.exports=o)}(V)),V.exports}var Wt=Ft();const _t=wt(Wt);function xt(c){if(typeof c!="string")throw new Error("Вхідні дані повинні бути рядком (String).");return zt(c).toString()}console.log(xt("password"));function bt(c,o){if(typeof c!="string"||typeof o!="string")throw new Error("Plaintext and password must be strings.");try{return _t.encrypt(o,c)}catch(d){throw console.error("Помилка шифрування SJCL:",d),d}}function H(c,o){if(typeof o!="string")throw new Error("Password must be a string.");if(typeof c!="string"&&typeof c!="object")throw new Error("Encrypted data must be a string or an object.");try{return _t.decrypt(o,c)}catch(d){throw console.error("Помилка дешифрування SJCL:",d),new Error("Не вдалося дешифрувати дані. Перевірте пароль або цілісність даних.")}}async function Yt(c,o,d,f,m){const u={id_note:c,fid_user:o,date:d,text:f,text_hash:m};try{const b=await fetch("http://localhost:8000/api/addNote",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(u)});if(!b.ok){const y=await b.json();throw new Error(`Помилка: ${JSON.stringify(y)}`)}return await b.json()}catch(b){throw console.error("Помилка додавання замітки:",b),b}}async function Et(c,o,d){const f={id_note:c,text:o,text_hash:d};try{const m=await fetch("http://localhost:8000/api/editNote",{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(f)});if(!m.ok){const b=await m.json();throw new Error(`Помилка: ${JSON.stringify(b)}`)}return await m.json()}catch(m){throw console.error("Помилка зміни замітки:",m),m}}async function Gt(c){const o={id_note:c};try{const d=await fetch("http://localhost:8000/api/deleteNote",{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o)});if(!d.ok){const m=await d.json();throw new Error(`Помилка: ${JSON.stringify(m)}`)}const f=await d.json();return{status:d.status,ok:d.ok,data:f}}catch(d){throw console.error("Помилка додавання замітки:",d),d}}let et=new Date;const kt=[];function rt(){return et}function z(c){et=new Date(c),kt.forEach(o=>o(et))}function It(c){kt.push(c)}const Vt=document.getElementById("prev-month"),Kt=document.getElementById("next-month"),K=document.getElementById("sidebar-days");let A=new Date;function F(c){K.innerHTML="",K.classList.add("calendar-sidebar__days--visible");const o=c.getFullYear(),d=c.getMonth(),m=new Date(o,d,1).getDay(),u=42,b=new Date,w=rt(),y=(E,_)=>E.getFullYear()===_.getFullYear()&&E.getMonth()===_.getMonth()&&E.getDate()===_.getDate();let S=new Date(o,d,1-m);for(let E=0;E<u;E++){const _=document.createElement("li");_.classList.add("calendar-sidebar__day"),_.textContent=S.getDate().toString(),S.getMonth()!==d&&_.classList.add("calendar-sidebar__day--other"),y(S,b)&&_.classList.add("calendar-sidebar__day--selected"),y(S,w)&&_.classList.add("calendar-sidebar__day--checked"),_.addEventListener("click",()=>{z(S)}),K.appendChild(_),S.setDate(S.getDate()+1)}}It(c=>{A=new Date(c),F(A)});Vt.addEventListener("click",()=>{A.setMonth(A.getMonth()-1),F(A)});Kt.addEventListener("click",()=>{A.setMonth(A.getMonth()+1),F(A)});F(A);const Xt=document.getElementById("month-title"),Zt=document.getElementById("month-title__highlight"),Qt=document.getElementById("prev-month"),te=document.getElementById("next-month"),ee=["January","February","March","April","May","June","July","August","September","October","November","December"];let O=new Date;function st(c){const o=ee[c.getMonth()],d=c.getFullYear();Xt.firstChild.nodeValue=`${o} `,Zt.textContent=d}Qt.addEventListener("click",()=>{O.setMonth(O.getMonth()-1),st(O)});te.addEventListener("click",()=>{O.setMonth(O.getMonth()+1),st(O)});st(O);class ne{constructor(o){this.modal=o,this.blocks=o.querySelectorAll(".js-signin-modal-block"),this.switchers=o.querySelectorAll(".js-signin-modal-switcher a"),this.triggers=document.querySelectorAll(".js-signin-modal-trigger"),this.hidePasswordBtns=o.querySelectorAll(".js-hide-password"),this.init()}init(){this.triggers.forEach(o=>{o.addEventListener("click",d=>{const f=d.target.closest("[data-signin]");if(f){d.preventDefault();const m=f.getAttribute("data-signin");this.showForm(m)}})}),this.modal.addEventListener("click",o=>{(o.target.classList.contains("js-signin-modal")||o.target.classList.contains("js-close"))&&(o.preventDefault(),this.modal.classList.remove("signin-modal--is-visible"))}),this.hidePasswordBtns.forEach(o=>{o.addEventListener("click",()=>this.togglePassword(o))})}togglePassword(o){const d=o.previousElementSibling,f=d.type==="password";d.type=f?"text":"password",o.textContent=f?"Hide":"Show",this.putCursorAtEnd(d)}showForm(o){this.modal.classList.add("signin-modal--is-visible"),this.blocks.forEach(f=>{f.classList.toggle("signin-modal__block--is-selected",f.getAttribute("data-type")===o)});const d=o==="signup"?"signup":"login";this.switchers.forEach(f=>{f.classList.toggle("selected",f.getAttribute("data-type")===d)})}putCursorAtEnd(o){o.focus();const d=o.value.length;o.setSelectionRange(d,d)}}const dt=document.querySelector(".js-signin-modal");dt&&new ne(dt);const X=document.querySelector(".js-main-nav");X&&X.addEventListener("click",c=>{c.target.classList.contains("js-main-nav")&&X.querySelector("ul").classList.toggle("main-nav__list--is-visible")});const oe=document.getElementById("signin");oe.addEventListener("click",async c=>{var f,m,u,b;c.preventDefault();const o=(f=document.querySelector("#signin-email"))==null?void 0:f.value.trim(),d=(m=document.querySelector("#signin-password"))==null?void 0:m.value.trim();try{const w=await Ot(o,d);if(w&&w.id_user){const{id_user:y,email:S,password:E,nickname:_,fullname:I,gender:x,country:t,notes:e}=w;localStorage.setItem("all_notes",JSON.stringify(e));const n={};for(const[r,s]of Object.entries(e))n[r]=s.map(i=>({id:i.id,hash:i.hash}));localStorage.setItem("all_notes_synced",JSON.stringify(n)),localStorage.setItem("id_user",y),localStorage.setItem("email",S),localStorage.setItem("password",E),localStorage.setItem("nickname",_),localStorage.setItem("fullname",I),localStorage.setItem("gender",x),localStorage.setItem("country",t),(u=document.querySelector(".js-signin-modal"))==null||u.classList.remove("signin-modal--is-visible"),ot({username:_,fullName:I},!0),(b=document.querySelector(".calendar__controls-profile"))==null||b.removeAttribute("data-signin"),location.reload()}else alert("Неправильні облікові дані")}catch(w){console.error("Помилка під час авторизації:",w),alert("Сталася помилка під час авторизації")}});const Z=localStorage.getItem("nickname"),Q=localStorage.getItem("fullname"),re=Z&&Z!==""?Z:"",se=Q&&Q!==""?Q:"";ot({fullName:se,username:re});const ie=document.getElementById("drop-down-menu-profile"),J=document.getElementById("dropdown-menu");ie.addEventListener("click",c=>{document.querySelector(".calendar__controls-profile").dataset.signIn||(J.classList.toggle("hidden"),c.stopPropagation())});document.addEventListener("click",()=>{J.classList.contains("hidden")||J.classList.add("hidden")});J.addEventListener("click",c=>{c.stopPropagation()});const ae=document.getElementById("dropdown-menu__account");ae.addEventListener("click",()=>{window.location.href="http://localhost:8000/profile"});const ce=document.getElementById("signup");ce.addEventListener("click",async c=>{var m,u,b,w,y;c.preventDefault();const o=(m=document.querySelector("#signup-username"))==null?void 0:m.value.trim(),d=(u=document.querySelector("#signup-email"))==null?void 0:u.value.trim(),f=(b=document.querySelector("#signup-password"))==null?void 0:b.value.trim();console.log(o,d,f);try{const S=await jt(d,f,o);if(S&&S.id_user){const{id_user:E,email:_,password:I,nickname:x,fullname:t,gender:e,country:n}=S;localStorage.setItem("id_user",E),localStorage.setItem("email",_),localStorage.setItem("password",I),localStorage.setItem("nickname",x),localStorage.setItem("fullname",t),localStorage.setItem("gender",e),localStorage.setItem("country",n),(w=document.querySelector(".js-signin-modal"))==null||w.classList.remove("signin-modal--is-visible"),ot({username:x,fullName:t},!0),(y=document.querySelector(".calendar__controls-profile"))==null||y.removeAttribute("data-signin")}else alert("Неправильні облікові дані")}catch(S){console.error("Помилка під час авторизації:",S),alert("Сталася помилка під час авторизації")}});const le=document.getElementById("dropdown-menu__logout");le.addEventListener("click",()=>{localStorage.clear(),location.reload()});async function ft(){const c=localStorage.getItem("id_user");if(!c)throw new Error("User ID not found in localStorage");try{const o=await fetch(`http://localhost:8000/api/user/${c}/notes`,{method:"GET",headers:{Accept:"application/json"}});if(!o.ok){const f=await o.json();throw new Error(`Error: ${JSON.stringify(f)}`)}const d=await o.json();return de(d.notes)}catch(o){throw console.error("Error fetching notes:",o),o}}function de(c){const o={};return c.forEach(d=>{const f=d.date;o[f]||(o[f]=[]),o[f].push({id:Number(d.id_note),hash:d.text_hash})}),o}async function ut(c){try{const o=await fetch(`http://localhost:8000/api/note/${c}`,{method:"GET",headers:{Accept:"application/json"}});if(!o.ok){const f=await o.json();throw new Error(`Error: ${JSON.stringify(f)}`)}return(await o.json()).note}catch(o){throw console.error("Error fetching note:",o),o}}function fe(c){const o=JSON.parse(localStorage.getItem("all_notes"))||{},d=[];for(const[f,m]of Object.entries(c))o[f]&&m.forEach(u=>{const b=o[f].find(w=>w.id===u.id);b&&b.hash!==u.hash&&d.push({date:f,noteId:u.id,serverHash:u.hash,localHash:b.hash})});return d}function ue(c,o,d){return new Promise((f,m)=>{const u=document.createElement("div");u.className="sync-modal";const b=`=== LOCAL VERSION ===
${c.decryptedText}

=== SERVER VERSION ===
${o.decryptedText}`;u.innerHTML=`
            <div class="sync-modal__content">
                <h2>Note Synchronization</h2>

                <div class="sync-modal__versions">
                    <div class="sync-modal__version">
                        <textarea class="sync-modal__textarea combined-version">${b}</textarea>
                    </div>
                </div>

                <div class="sync-modal__actions">
                    <button class="sync-modal__button use-merged">Save Edited Content</button>
                    <button class="sync-modal__button cancel">Cancel</button>
                </div>
            </div>
        `,document.body.appendChild(u),u.querySelector(".use-merged").addEventListener("click",()=>{const w=u.querySelector(".combined-version").value,y=localStorage.getItem("password"),S=bt(w,y),E=window.crypto||window.msCrypto,I=new TextEncoder().encode(w);E.subtle.digest("SHA-256",I).then(x=>{const e=Array.from(new Uint8Array(x)).map(n=>n.toString(16).padStart(2,"0")).join("");f({text:S,hash:e,decryptedText:w}),document.body.removeChild(u)})}),u.querySelector(".cancel").addEventListener("click",()=>{m(new Error("User cancelled conflict resolution")),document.body.removeChild(u)})})}async function Bt(){try{const c=await ft();localStorage.setItem("all_notes_synced",JSON.stringify(c));const o=fe(c);for(const u of o){const b=await ut(u.noteId),w=JSON.parse(localStorage.getItem("all_notes")),y=w[u.date].find(x=>x.id===u.noteId),S=localStorage.getItem("password"),E={...y,decryptedText:H(y.text,S)},_={...b,decryptedText:H(b.text,S)},I=await ue(E,_,u.date);w[u.date]=w[u.date].map(x=>x.id===u.noteId?{...x,text:I.text,hash:I.hash}:x),localStorage.setItem("all_notes",JSON.stringify(w)),await Et(u.noteId,I.text,I.hash)}const d=JSON.parse(localStorage.getItem("all_notes"))||{};let f=0;for(const[u,b]of Object.entries(c)){d[u]||(d[u]=[]);for(const w of b)if(!d[u].some(S=>S.id===w.id)){const S=await ut(w.id);d[u].push({id:w.id,text:S.text,hash:w.hash}),f++}}f>0&&localStorage.setItem("all_notes",JSON.stringify(d));const m=await ft();return localStorage.setItem("all_notes_synced",JSON.stringify(m)),{success:!0,conflictsResolved:o.length,newNotesAdded:f}}catch(c){return console.error("Error during synchronization:",c),{success:!1,error:c.message}}}const Nt=document.createElement("style");Nt.textContent=`
.sync-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.sync-modal__content {
    background-color: white;
    padding: 20px;
    border-radius: 5px;
    max-width: 800px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}

.sync-modal__versions {
    margin: 20px 0;
}

.sync-modal__version {
    width: 100%;
}

.sync-modal__textarea {
    width: 100%;
    height: 300px; /* Increased height for better visibility */
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    resize: vertical;
    font-family: monospace; /* Better for displaying formatted text */
    font-size: 14px;
    line-height: 1.5;
}

.sync-modal__actions {
    display: flex;
    justify-content: center; /* Center the buttons */
    flex-wrap: wrap;
    gap: 15px; /* Increased gap between buttons */
    margin-top: 20px;
}

.sync-modal__button {
    padding: 10px 20px; /* Larger buttons */
    border: none;
    border-radius: 4px;
    cursor: pointer;
    background-color: #4CAF50;
    color: white;
    font-weight: bold;
    transition: background-color 0.2s;
}

.sync-modal__button:hover {
    background-color: #45a049; /* Darker green on hover */
}

.sync-modal__button.cancel {
    background-color: #f44336;
}

.sync-modal__button.cancel:hover {
    background-color: #d32f2f; /* Darker red on hover */
}
`;document.head.appendChild(Nt);const B={},he=JSON.parse(localStorage.getItem("all_notes"))||{};for(const[c,o]of Object.entries(he))B[c]=o;const pe=localStorage.getItem("id_user");async function me(){if(pe)try{const c=await Bt();if(c.success){if(c.newNotesAdded>0||c.conflictsResolved>0){const o=JSON.parse(localStorage.getItem("all_notes"))||{};for(const d in B)delete B[d];for(const[d,f]of Object.entries(o))B[d]=f}}else console.error("Auto-sync failed:",c.error)}catch(c){console.error("Error during auto-sync:",c)}W(new Date)}me();const ht=document.querySelector(".calendar-sidebar__task-list"),ge=["SUN","MON","TUE","WED","THU","FRI","SAT"];function ye(c){const o=c.getFullYear(),d=(c.getMonth()+1).toString().padStart(2,"0"),f=c.getDate().toString().padStart(2,"0");return`${o}-${d}-${f}`}function ve(c){return`${c.getMonth()+1}/${c.getDate()}/${c.getFullYear()}`}function we(c){return c===0?"TODAY":c===1?"TOMORROW":ge[new Date(Date.now()+c*864e5).getDay()]}function Se(c){let o=c;return o=o.replace(/\*\*(.*?)\*\*/gs,"$1"),o=o.replace(/\*(.*?)\*/gs,"$1"),o=o.replace(/_(.*?)_/gs,"$1"),o=o.replace(/<br\s*\/?>/gi,`
`),o}function _e(c){return c.split(/\r?\n/)}function xe(c){return c.length>20?c.slice(0,20)+"...":c}function R(c){var o,d;ht.innerHTML="";for(let f=0;f<9;f++){const m=new Date(c);m.setDate(m.getDate()+f);const u=we(f),b=ye(m),w=ve(m),y=B[b]||[],S=document.createElement("li");S.classList.add("calendar-sidebar__task-item"),f===0&&((d=(o=S.querySelector)==null?void 0:o.call(S,"h3"))==null||d.classList.add("calendar-sidebar__task-day--selected")),S.innerHTML=`
      <div class="calendar-sidebar__task-header">
        <div class="calendar-sidebar__task-time">
          <h3 class="calendar-sidebar__task-day ${f===0?"calendar-sidebar__task-day--selected":""}">${u}</h3>
          <p class="calendar-sidebar__task-date ${f===0?"calendar-sidebar__task-date--selected":""}">${w}</p>
        </div>
      </div>
      <ul class="calendar-sidebar__task-tasks"></ul>
    `;const E=S.querySelector(".calendar-sidebar__task-tasks");y.forEach(_=>{const I=document.createElement("li"),x=localStorage.getItem("password"),t=H(_.text,x),e=Se(t),r=_e(e)[0],s=xe(r);I.classList.add("calendar-sidebar__task-tasks-item"),I.innerHTML=`
        <div class="calendar-sidebar__task-tasks-circle"></div>
        <p class="calendar-sidebar__task-tasks-text">${s}</p>
      `,E.appendChild(I)}),ht.appendChild(S)}}R(new Date);const be=document.getElementById("add-note");be.addEventListener("click",()=>{U()});function U(c=null){const o=document.createElement("div");o.id="editor",o.className="note-box__container";const d=document.createElement("textarea");d.className="note-box__editor",d.rows=5;const f=document.createElement("div");f.className="note-box__buttons",f.innerHTML=`
    <div class="note-box__tool">
        <div class="note-box__tool-formatting">
          <button class="note-btn bold"><b>Bold</b></button>
          <button class="note-btn italic"><i>Italic</i></button>
          <button class="note-btn underline"><u>Underline</u></button>
        </div>
        <div class="note-box__action">
          <button class="note-btn note-save">Save</button>
          <button class="note-btn note-cancel">Cancel</button>
          <button class="note-btn note-remove">Remove</button>
        </div>
      </div>
  `,o.appendChild(d),o.appendChild(f);const m=document.getElementById("day-event");console.log(m.dataset.date),c?(d.value=c.dataset.raw||c.innerText,o.dataset.existing="true",o.dataset.noteId=c.dataset.noteId,o.dataset.original=d.value,m.replaceChild(o,c)):(o.dataset.original="",m.appendChild(o)),f.querySelector(".bold").onclick=()=>tt(d,"**"),f.querySelector(".italic").onclick=()=>tt(d,"*"),f.querySelector(".underline").onclick=()=>tt(d,"_"),f.querySelector(".note-save").onclick=async()=>{const u=d.value,b=nt(u),w=document.createElement("div");w.className="note-display",w.innerHTML=b,w.dataset.raw=u,w.onclick=()=>U(w);const y=document.getElementById("day-event").dataset.date;B[y]||(B[y]=[]);const S=localStorage.getItem("password");if(!S){alert("Шифрувальний ключ не знайдено!");return}const E=bt(u,S),_=xt(u),I=localStorage.getItem("id_user");if(o.dataset.existing==="true"){const x=o.dataset.noteId;w.dataset.noteId=x;const t=B[y].findIndex(r=>r.id===Number(x));t!==-1&&(B[y][t]={id:Number(x),text:E,hash:_});const e=JSON.parse(localStorage.getItem("all_notes"))||{};e[y]||(e[y]=[]);const n=e[y].findIndex(r=>r.id===Number(x));n!==-1?(e[y][n].text=E,e[y][n].hash=_):e[y].push({id:Number(x),text:E,hash:_}),localStorage.setItem("all_notes",JSON.stringify(e));try{const r=await Et(Number(x),E,_),s=JSON.parse(localStorage.getItem("all_notes_synced"))||{};if(s[y]){const i=s[y].findIndex(a=>a.id===Number(x));i!==-1&&(s[y][i].id=Number(r.id),s[y][i].hash=r.hash,localStorage.setItem("all_notes_synced",JSON.stringify(s)))}}catch(r){console.error("Не вдалося оновити замітку на сервері:",r)}finally{m.replaceChild(w,o)}}else{const x=Date.now().toString();w.dataset.noteId=x,B[y].push({id:Number(x),text:E,hash:_});const t=JSON.parse(localStorage.getItem("all_notes"))||{};t[y]||(t[y]=[]),t[y].push({id:Number(x),text:E,hash:_}),localStorage.setItem("all_notes",JSON.stringify(t));try{const e=await Yt(Number(x),Number(I),y,E,_);console.log("addNotes response:",e);const n=JSON.parse(localStorage.getItem("all_notes_synced"))||{};n[y]||(n[y]=[]),n[y].push({id:Number(e.id_note),hash:e.text_hash}),localStorage.setItem("all_notes_synced",JSON.stringify(n))}catch(e){console.error("Не вдалося синхронізувати замітку з сервером:",e)}finally{m.replaceChild(w,o)}}R(new Date)},f.querySelector(".note-cancel").onclick=()=>{if(o.dataset.existing==="true"){const u=document.createElement("div");u.className="note-display",u.dataset.noteId=o.dataset.noteId,u.dataset.raw=o.dataset.original,u.innerHTML=nt(o.dataset.original),u.onclick=()=>U(u),m.replaceChild(u,o)}else m.removeChild(o)},f.querySelector(".note-remove").onclick=async()=>{const u=m.dataset.date;if(o.dataset.existing==="true"){if(confirm("Чи дійсно ви хочете видалити дану замітку?")){const w=o.dataset.noteId;B[u]&&(B[u]=B[u].filter(S=>S.id!==Number(w)),console.log(B),B[u].length===0&&delete B[u]);let y=JSON.parse(localStorage.getItem("all_notes"))||{};y[u]&&(y[u]=y[u].filter(S=>String(S.id)!==w),y[u].length===0&&delete y[u],localStorage.setItem("all_notes",JSON.stringify(y)));try{if((await Gt(Number(w))).status===200){let _=JSON.parse(localStorage.getItem("all_notes_synced"))||{};_[u]&&(_[u]=_[u].filter(I=>String(I.id)!==w),_[u].length===0&&delete _[u],localStorage.setItem("all_notes_synced",JSON.stringify(_)))}const E=document.querySelector(`.note-display[data-note-id="${w}"]`);E&&E.remove()}catch(S){console.error("Помилка під час видалення замітки:",S)}finally{o.remove(),R(new Date)}}}else o.remove(),R(new Date)}}function nt(c){return c.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\*\*(.*?)\*\*/gs,'<span class="bold">$1</span>').replace(/\*(.*?)\*/gs,'<span class="italic">$1</span>').replace(/_(.*?)_/gs,'<span class="underline">$1</span>').replace(/\n/g,"<br>")}function tt(c,o){const d=c.selectionStart,f=c.selectionEnd,m=c.value.slice(d,f),u=c.value.slice(0,d),b=c.value.slice(f);c.value=u+o+m+o+b,c.focus(),c.selectionStart=d+o.length,c.selectionEnd=f+o.length}function Ee(c){const o=c.getFullYear(),d=(c.getMonth()+1).toString().padStart(2,"0"),f=c.getDate().toString().padStart(2,"0");return`${o}-${d}-${f}`}function W(c){const o=Ee(c),d=document.getElementById("day-event");if(d.innerHTML="",d.dataset.date=o,B!=null&&B[o])for(const f of B[o]){const m=document.createElement("div");m.className="note-display",m.dataset.noteId=f.id;const u=localStorage.getItem("password"),b=H(f.text,u);m.dataset.raw=b,m.innerHTML=nt(b),m.onclick=()=>U(m),d.appendChild(m)}}const ke=document.getElementById("prev-day"),Ie=document.getElementById("today"),Be=document.getElementById("next-day"),pt=document.getElementById("sidebar-days"),Ne=document.getElementById("day-event"),Le=document.getElementById("month-title"),De=document.getElementById("month-title__highlight");let D=rt();function Ae(c){const o=["January","February","March","April","May","June","July","August","September","October","November","December"];Le.firstChild.nodeValue=`${o[c.getMonth()]} `,De.textContent=c.getFullYear()}function Lt(c){const o=new Date,d=(I,x)=>I.getFullYear()===x.getFullYear()&&I.getMonth()===x.getMonth()&&I.getDate()===x.getDate(),f=rt(),m=c.getFullYear(),u=c.getMonth(),w=new Date(m,u,1).getDay();let y=new Date(m,u,1-w);pt.innerHTML="";for(let I=0;I<42;I++){const x=document.createElement("li");x.classList.add("calendar-sidebar__day"),x.textContent=y.getDate().toString(),y.getMonth()!==u&&x.classList.add("calendar-sidebar__day--other"),d(y,o)&&x.classList.add("calendar-sidebar__day--selected"),d(y,f)&&x.classList.add("calendar-sidebar__day--checked"),pt.appendChild(x),y.setDate(y.getDate()+1)}const S=f.getFullYear(),E=(f.getMonth()+1).toString().padStart(2,"0"),_=f.getDate().toString().padStart(2,"0");Ne.dataset.date=`${S}-${E}-${_}`,Ae(c)}It(c=>{D=new Date(c);const o=document.getElementById("editor");o&&o.remove(),Lt(D),W(D)});ke.addEventListener("click",()=>{D.setDate(D.getDate()-1);const c=document.getElementById("editor");c&&c.remove(),z(D)});Be.addEventListener("click",()=>{D.setDate(D.getDate()+1);const c=document.getElementById("editor");c&&c.remove(),z(D)});Ie.addEventListener("click",()=>{D=new Date;const c=document.getElementById("editor");c&&c.remove(),z(D)});Lt(D);const Ce=document.getElementById("prev-day"),Oe=document.getElementById("today"),je=document.getElementById("next-day"),Te=document.getElementById("main-day-name"),Me=document.getElementById("main-day-number"),$e=["SUN","MON","TUE","WED","THU","FRI","SAT"];let j=new Date;function Re(c){return`${c.getDate()}`}function qe(c){return $e[c.getDay()]}function Y(){Te.textContent=qe(j),Me.textContent=Re(j)}Ce.addEventListener("click",()=>{j.setDate(j.getDate()-1),Y()});je.addEventListener("click",()=>{j.setDate(j.getDate()+1),Y()});Oe.addEventListener("click",()=>{j=new Date,Y()});Y();const mt=document.getElementById("dropdown-menu__export");mt&&mt.addEventListener("click",()=>{try{if(!B)return console.error("notesStorage is not defined"),alert("Notes storage is not available. Please try refreshing the page."),!1;const c=B;if(console.log("Current notes:",c),!c||Object.keys(c).length===0)return alert("No notes to export"),!1;const o={version:"1.0",exportDate:new Date().toISOString(),notes:c};console.log("Export data:",o);const d=JSON.stringify(o,null,2),f=new Blob([d],{type:"application/json"}),m=URL.createObjectURL(f),u=document.createElement("a");u.href=m,u.download=`notes_export_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(m),alert("Notes exported successfully!")}catch(c){console.error("Export error details:",c),console.error("Error stack:",c.stack),alert("Error exporting notes. Please check the console for details.")}return!1});const gt=document.getElementById("dropdown-menu__import");gt&&gt.addEventListener("click",c=>{const o=c.target.files[0];if(!o)return;const d=new FileReader;d.onload=()=>{try{const f=JSON.parse(c.target.result);typeof f=="object"&&f!==null?(console.log(f),alert("Імпорт заміток пройшов успішно!")):alert("Невірний формат файлу")}catch(f){alert("Помилка при читанні файлу: "+f.message)}},d.readAsText(o)});const yt=document.getElementById("dropdown-menu__import");yt&&yt.addEventListener("click",()=>{const c=document.createElement("input");c.type="file",c.accept=".json",c.addEventListener("change",async function(){const o=this.files[0];if(o)try{const d=await o.text(),f=JSON.parse(d);if(!f.version||!f.notes)throw new Error("Invalid file format");let m=0,u=0;for(const[w,y]of Object.entries(f.notes)){B[w]||(B[w]=[]);for(const S of y)B[w].some(_=>_.hash===S.hash)?u++:(B[w].push(S),m++)}const b=JSON.parse(localStorage.getItem("all_notes"))||{};Object.assign(b,f.notes),localStorage.setItem("all_notes",JSON.stringify(b)),R(new Date),W(D),alert(`Import completed!
Imported: ${m} notes
Skipped: ${u} duplicate notes`)}catch(d){console.error("Import error:",d),alert("Error importing notes: "+d.message)}}),c.click()});const C=document.getElementById("sync"),vt=document.getElementById("successsync");C.addEventListener("click",async()=>{C.disabled=!0;try{C.classList.add("syncing");const c=await Bt();if(c.success){let o="Synchronization completed successfully.";if(c.conflictsResolved>0&&(o+=` ${c.conflictsResolved} conflicts resolved.`),c.newNotesAdded>0&&(o+=` ${c.newNotesAdded} new notes added.`),c.conflictsResolved===0&&c.newNotesAdded===0&&(o+=" No changes needed."),alert(o),c.newNotesAdded>0){const d=JSON.parse(localStorage.getItem("all_notes"))||{};for(const u in B)delete B[u];for(const[u,b]of Object.entries(d))B[u]=b;const f=document.getElementById("day-event"),m=f&&f.dataset.date?new Date(f.dataset.date):new Date;W(m)}C.hidden=!0,vt.hidden=!1,setTimeout(()=>{C.hidden=!1,vt.hidden=!0},3e3)}else alert(`Synchronization failed: ${c.error}`)}catch(c){console.error("Synchronization error:",c),alert(`Synchronization error: ${c.message}`)}finally{C.disabled=!1,C.classList.remove("syncing")}});const Dt=document.createElement("style");Dt.textContent=`
.calendar__controls-sync_unsync.syncing {
    opacity: 0.5;
    cursor: not-allowed;
}
`;document.head.appendChild(Dt);
