import{a as q,h as L,c as b}from"./authUser-8hiuLYTf.js";class j{constructor(e){this.modal=e,this.blocks=e.querySelectorAll(".js-signin-modal-block"),this.switchers=e.querySelectorAll(".js-signin-modal-switcher a"),this.triggers=document.querySelectorAll(".js-signin-modal-trigger"),this.hidePasswordBtns=e.querySelectorAll(".js-hide-password"),this.init()}init(){this.triggers.forEach(e=>{e.addEventListener("click",s=>{const t=s.target.closest("[data-signin]");if(t){s.preventDefault();const a=t.getAttribute("data-signin");this.showForm(a)}})}),this.modal.addEventListener("click",e=>{(e.target.classList.contains("js-signin-modal")||e.target.classList.contains("js-close"))&&(e.preventDefault(),this.modal.classList.remove("signin-modal--is-visible"))}),this.hidePasswordBtns.forEach(e=>{e.addEventListener("click",()=>this.togglePassword(e))})}togglePassword(e){const s=e.previousElementSibling,t=s.type==="password";s.type=t?"text":"password",e.textContent=t?"Hide":"Show",this.putCursorAtEnd(s)}showForm(e){this.modal.classList.add("signin-modal--is-visible"),this.blocks.forEach(t=>{t.classList.toggle("signin-modal__block--is-selected",t.getAttribute("data-type")===e)});const s=e==="signup"?"signup":"login";this.switchers.forEach(t=>{t.classList.toggle("selected",t.getAttribute("data-type")===s)})}putCursorAtEnd(e){e.focus();const s=e.value.length;e.setSelectionRange(s,s)}}const I=document.querySelector(".js-signin-modal");I&&new j(I);const y=document.querySelector(".js-main-nav");y&&y.addEventListener("click",n=>{n.target.classList.contains("js-main-nav")&&y.querySelector("ul").classList.toggle("main-nav__list--is-visible")});const B=document.getElementById("signin");B.addEventListener("click",async n=>{var t,a,l,r;n.preventDefault();const e=(t=document.querySelector("#signin-email"))==null?void 0:t.value.trim(),s=(a=document.querySelector("#signin-password"))==null?void 0:a.value.trim();try{const o=await q(e,s);if(o&&o.id_user){const{id_user:c,email:i,password:f,nickname:d,fullname:m,gender:u,country:g,notes:p}=o;localStorage.setItem("all_notes",JSON.stringify(p));const h={};for(const[_,k]of Object.entries(p))h[_]=k.map(E=>({id:E.id,hash:E.hash}));localStorage.setItem("all_notes_synced",JSON.stringify(h)),localStorage.setItem("id_user",c),localStorage.setItem("email",i),localStorage.setItem("password",f),localStorage.setItem("nickname",d),localStorage.setItem("fullname",m),localStorage.setItem("gender",u),localStorage.setItem("country",g),(l=document.querySelector(".js-signin-modal"))==null||l.classList.remove("signin-modal--is-visible"),L({username:d,fullName:m},!0),(r=document.querySelector(".calendar__controls-profile"))==null||r.removeAttribute("data-signin"),location.reload()}else alert("Неправильні облікові дані")}catch(o){console.error("Помилка під час авторизації:",o),alert("Сталася помилка під час авторизації")}});const v=localStorage.getItem("nickname"),w=localStorage.getItem("fullname"),N=v&&v!==""?v:"",A=w&&w!==""?w:"";L({fullName:A,username:N});const P=document.getElementById("drop-down-menu-profile"),S=document.getElementById("dropdown-menu");P.addEventListener("click",n=>{document.querySelector(".calendar__controls-profile").dataset.signIn||(S.classList.toggle("hidden"),n.stopPropagation())});document.addEventListener("click",()=>{S.classList.contains("hidden")||S.classList.add("hidden")});S.addEventListener("click",n=>{n.stopPropagation()});const D=document.getElementById("dropdown-menu__account");D.addEventListener("click",()=>{window.location.href="http://localhost:8000/profile"});const C=document.getElementById("signup");C.addEventListener("click",async n=>{var a,l,r,o,c;n.preventDefault();const e=(a=document.querySelector("#signup-username"))==null?void 0:a.value.trim(),s=(l=document.querySelector("#signup-email"))==null?void 0:l.value.trim(),t=(r=document.querySelector("#signup-password"))==null?void 0:r.value.trim();console.log(e,s,t);try{const i=await b(s,t,e);if(i&&i.id_user){const{id_user:f,email:d,password:m,nickname:u,fullname:g,gender:p,country:h}=i;localStorage.setItem("id_user",f),localStorage.setItem("email",d),localStorage.setItem("password",m),localStorage.setItem("nickname",u),localStorage.setItem("fullname",g),localStorage.setItem("gender",p),localStorage.setItem("country",h),(o=document.querySelector(".js-signin-modal"))==null||o.classList.remove("signin-modal--is-visible"),L({username:u,fullName:g},!0),(c=document.querySelector(".calendar__controls-profile"))==null||c.removeAttribute("data-signin")}else alert("Неправильні облікові дані")}catch(i){console.error("Помилка під час авторизації:",i),alert("Сталася помилка під час авторизації")}});const O=document.getElementById("dropdown-menu__logout");O.addEventListener("click",()=>{localStorage.clear(),location.reload()});
