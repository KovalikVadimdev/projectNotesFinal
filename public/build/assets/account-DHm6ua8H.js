const S=document.getElementById("profile-header-title"),h=document.getElementById("profile-header-text"),E=document.getElementById("profile-overview-name"),I=document.getElementById("profile-overview-email"),f=document.getElementById("full_name"),g=document.getElementById("nickname"),y=document.getElementById("gender"),p=document.getElementById("country"),d=document.getElementById("profile-emails-email");localStorage.getItem("country");const l=localStorage.getItem("email"),a=localStorage.getItem("fullname");localStorage.getItem("gender");const u=localStorage.getItem("nickname"),v=(a==null?void 0:a.trim())||u;S.textContent=`Welcome, ${v}`;const k={weekday:"short",year:"numeric",month:"long",day:"2-digit"},C=new Date,x=C.toLocaleDateString("en-US",k);h.textContent+=`${x}`;a&&a.trim()!==""?E.textContent=a:u&&(E.textContent=u);l&&(I.textContent=l);d&&l&&(d.textContent=l);function m(n,o){const e=localStorage.getItem(o);console.log(e),e&&e.trim()!==""&&(n.value=e)}m(f,"fullname");m(g,"nickname");m(y,"gender");m(p,"country");const w=document.getElementById("profile-emails-button");w.addEventListener("click",async()=>{const n=prompt("Введіть новий email:","");if(n===null)return;const o=n.trim();if(!o){alert("Будь ласка, введіть валідний email.");return}try{const e=await fetch("http://127.0.0.1:8000/api/user/update-email",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({currentEmail:l,newEmail:o})}),t=await e.json();if(e.ok)localStorage.setItem("email",t.email),d.textContent=t.email,I.textContent=t.email,alert("Email успішно оновлено!");else if(e.status===422&&t.errors){const s=Object.values(t.errors)[0][0];alert(s)}else t.error?alert(t.error):alert("Сталася невідома помилка.")}catch(e){alert("Помилка мережі або сервер недоступний."),console.error(e)}});const r=document.getElementById("profile-overview-edit"),c=[f,g,y,p];let i=!1;c.forEach(n=>n.disabled=!0);r.addEventListener("click",async()=>{var n,o;if(!i)c.forEach(e=>e.disabled=!1),r.textContent="Save",i=!0;else{c.forEach(t=>t.disabled=!0);const e={email:l,fullName:f.value.trim()||null,nickname:g.value.trim(),gender:((n=y.value)==null?void 0:n.trim())||null,country:((o=p.value)==null?void 0:o.trim())||null};try{if(!(await fetch("http://127.0.0.1:8000/api/user/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("Не вдалося оновити дані");localStorage.setItem("country",e.country),localStorage.setItem("fullname",e.fullName),localStorage.setItem("gender",e.gender),localStorage.setItem("nickname",e.nickname),r.textContent="Edit",i=!1,alert("Дані успішно оновлено")}catch(t){console.error(t),alert("Сталася помилка при оновленні даних"),c.forEach(s=>s.disabled=!1),r.textContent="Save",i=!0}}});
